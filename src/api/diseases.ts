import axios from "axios";
import { api } from "@/api/client";
import type { DiseaseDto, DiseaseStatsDto } from "@/types/Disease";

const TENANT = "clinic1";

const mockedDisease: DiseaseDto = {
  id: "1",
  name: "Биполярное расстройство I типа (БАР I)",
  code: "МКБ-10: F31.1",
  description:
    "Биполярное расстройство I типа — хроническое аффективное заболевание, при котором у пациента возникают выраженные маниакальные эпизоды, часто чередующиеся с депрессивными фазами и периодами относительной ремиссии. В маниакальной фазе наблюдаются патологически приподнятое или раздражительное настроение, снижение потребности во сне, ускорение мышления и речи, повышение двигательной активности, импульсивное поведение и переоценка собственных возможностей. На фоне критического снижения самоконтроля могут возникать рискованные финансовые решения, конфликты в семье и на работе, а также небезопасные действия, требующие неотложной клинической оценки. Депрессивные эпизоды проявляются подавленным настроением, ангедонией, выраженной утомляемостью, когнитивным снижением, чувством вины и суицидальными мыслями. Течение заболевания неоднородно: длительность фаз и интенсивность симптомов различаются у разных пациентов, а стресс, нарушения режима сна и отказ от терапии повышают вероятность рецидива. Ведение БАР I требует долгосрочного наблюдения, психообразования пациента и близких, поддержания стабильного режима сна и бодрствования, а также регулярной оценки безопасности и приверженности лечению.",
  clinicalCourse:
    "Течение рецидивирующее. После первого маниакального эпизода риск повторных фаз сохраняется в течение всей жизни. Между эпизодами возможны периоды функционального восстановления, однако у части пациентов остаются резидуальные когнитивные и эмоциональные нарушения. Требуется длительная поддерживающая терапия с регулярным мониторингом психического состояния, сна, поведенческих факторов и соматического профиля безопасности.",
  symptoms: [
    "Периоды выраженно повышенного или раздражительного настроения",
    "Снижение потребности во сне без ощущения усталости",
    "Ускорение речи, скачка идей, повышенная отвлекаемость",
    "Импульсивные и рискованные поступки",
    "Эпизоды глубокой депрессии с ангедонией и психомоторным торможением",
  ],
  complications: [
    "Суицидальное поведение",
    "Социальная и профессиональная дезадаптация",
    "Злоупотребление психоактивными веществами",
    "Повторные госпитализации при тяжелых эпизодах",
  ],
  recommendedExams: [
    "Психиатрическое клиническое интервью с оценкой фазности",
    "Скрининг суицидального риска и факторов безопасности",
    "Оценка сна, циркадных ритмов и стрессовых триггеров",
    "Лабораторный мониторинг при нормотимической терапии",
    "Психометрические шкалы для динамического наблюдения",
  ],
  createdAt: "2026-01-02T09:00:00Z",
};

const mockedStats: DiseaseStatsDto = {
  totalPatients: 148,
  activeCases: 124,
  newCasesLast30Days: 12,
  averageTreatmentDurationDays: 214,
  updatedAt: "2026-02-18T08:30:00Z",
};

export async function getDiseaseById(id: string): Promise<DiseaseDto> {
  try {
    const response = await api.get<DiseaseDto>(`/api/diseases/${id}?tenant=${TENANT}`);
    return response.data;
  } catch (error) {
    if (axios.isAxiosError(error) && (!error.response || error.response.status === 404 || error.response.status === 501)) {
      return { ...mockedDisease, id };
    }

    throw error;
  }
}

export async function getDiseaseStatsById(id: string): Promise<DiseaseStatsDto> {
  try {
    const response = await api.get<DiseaseStatsDto>(`/api/diseases/${id}/stats?tenant=${TENANT}`);
    return response.data;
  } catch (error) {
    if (axios.isAxiosError(error) && (!error.response || error.response.status === 404 || error.response.status === 501)) {
      return mockedStats;
    }

    throw error;
  }
}
